const echoController = require('./echoController')
const carouselController = require('./carouselController')
var booksDummy = {
    "kind": "books#volumes",
    "totalItems": 3,
    "items": [
     {
      "kind": "books#volume",
      "id": "rXM1DgAAQBAJ",
      "etag": "C9R896NuX28",
      "selfLink": "https://www.googleapis.com/books/v1/volumes/rXM1DgAAQBAJ",
      "volumeInfo": {
       "title": "Medical and Psychosocial Aspects of Chronic Illness and Disability",
       "authors": [
        "Carlene Harrison",
        "University of North Carolina North Carolina Donna Falvo",
        "Valerie Weiss",
        "Donna Falvo",
        "Beverley E. Holland"
       ],
       "publisher": "Jones & Bartlett Learning",
       "publishedDate": "2017-01-15",
       "description": "Medical and Psychosocial Aspects of Chronic Illness, Sixth Edition is intended to teach students, counselors and other medical professionals working with the chronically ill and disabled how to better understand the manifestations of common chronic illnesses and the disabilities among their clients.",
       "industryIdentifiers": [
        {
         "type": "ISBN_13",
         "identifier": "9781284105414"
        },
        {
         "type": "ISBN_10",
         "identifier": "1284105415"
        }
       ],
       "readingModes": {
        "text": false,
        "image": true
       },
       "pageCount": 650,
       "printType": "BOOK",
       "categories": [
        "Medical"
       ],
       "maturityRating": "NOT_MATURE",
       "allowAnonLogging": false,
       "contentVersion": "0.1.0.0.preview.1",
       "panelizationSummary": {
        "containsEpubBubbles": false,
        "containsImageBubbles": false
       },
       "imageLinks": {
        "smallThumbnail": "http://books.google.com/books/content?id=rXM1DgAAQBAJ&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api",
        "thumbnail": "http://books.google.com/books/content?id=rXM1DgAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api"
       },
       "language": "en",
       "previewLink": "http://books.google.co.id/books?id=rXM1DgAAQBAJ&printsec=frontcover&dq=medical&hl=&cd=1&source=gbs_api",
       "infoLink": "http://books.google.co.id/books?id=rXM1DgAAQBAJ&dq=medical&hl=&source=gbs_api",
       "canonicalVolumeLink": "https://books.google.com/books/about/Medical_and_Psychosocial_Aspects_of_Chro.html?hl=&id=rXM1DgAAQBAJ"
      },
      "saleInfo": {
       "country": "ID",
       "saleability": "NOT_FOR_SALE",
       "isEbook": false
      },
      "accessInfo": {
       "country": "ID",
       "viewability": "PARTIAL",
       "embeddable": true,
       "publicDomain": false,
       "textToSpeechPermission": "ALLOWED",
       "epub": {
        "isAvailable": false
       },
       "pdf": {
        "isAvailable": false
       },
       "webReaderLink": "http://play.google.com/books/reader?id=rXM1DgAAQBAJ&hl=&printsec=frontcover&source=gbs_api",
       "accessViewStatus": "SAMPLE",
       "quoteSharingAllowed": false
      },
      "searchInfo": {
       "textSnippet": "Medical and Psychosocial Aspects of Chronic Illness, Sixth Edition is intended to teach students, counselors and other medical professionals working with the chronically ill and disabled how to better understand the manifestations of common ..."
      }
     },
     {
      "kind": "books#volume",
      "id": "yjdQ8jTuCfgC",
      "etag": "LWZd+Dee7Dc",
      "selfLink": "https://www.googleapis.com/books/v1/volumes/yjdQ8jTuCfgC",
      "volumeInfo": {
       "title": "Medical Multimedia",
       "authors": [
        "Roy Rada",
        "Claude Ghaoui"
       ],
       "publisher": "Intellect Books",
       "publishedDate": "1995",
       "description": "This volume asserts that multimedia plays an increasingly important role in training and development for high-technology medical techniques. It examines a broad range of methods for incorporating computer-based multimedia packages into the world of medicine.",
       "industryIdentifiers": [
        {
         "type": "ISBN_10",
         "identifier": "1871516633"
        },
        {
         "type": "ISBN_13",
         "identifier": "9781871516630"
        }
       ],
       "readingModes": {
        "text": true,
        "image": true
       },
       "pageCount": 197,
       "printType": "BOOK",
       "categories": [
        "Medical"
       ],
       "maturityRating": "NOT_MATURE",
       "allowAnonLogging": false,
       "contentVersion": "1.2.4.0.preview.3",
       "panelizationSummary": {
        "containsEpubBubbles": false,
        "containsImageBubbles": false
       },
       "imageLinks": {
        "smallThumbnail": "http://books.google.com/books/content?id=yjdQ8jTuCfgC&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api",
        "thumbnail": "http://books.google.com/books/content?id=yjdQ8jTuCfgC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api"
       },
       "language": "en",
       "previewLink": "http://books.google.co.id/books?id=yjdQ8jTuCfgC&printsec=frontcover&dq=medical&hl=&cd=2&source=gbs_api",
       "infoLink": "https://play.google.com/store/books/details?id=yjdQ8jTuCfgC&source=gbs_api",
       "canonicalVolumeLink": "https://market.android.com/details?id=book-yjdQ8jTuCfgC"
      },
      "saleInfo": {
       "country": "ID",
       "saleability": "FOR_SALE",
       "isEbook": true,
       "listPrice": {
        "amount": 193450.0,
        "currencyCode": "IDR"
       },
       "retailPrice": {
        "amount": 131546.0,
        "currencyCode": "IDR"
       },
       "buyLink": "https://play.google.com/store/books/details?id=yjdQ8jTuCfgC&rdid=book-yjdQ8jTuCfgC&rdot=1&source=gbs_api",
       "offers": [
        {
         "finskyOfferType": 1,
         "listPrice": {
          "amountInMicros": 1.9345E11,
          "currencyCode": "IDR"
         },
         "retailPrice": {
          "amountInMicros": 1.31546E11,
          "currencyCode": "IDR"
         }
        }
       ]
      },
      "accessInfo": {
       "country": "ID",
       "viewability": "PARTIAL",
       "embeddable": true,
       "publicDomain": false,
       "textToSpeechPermission": "ALLOWED",
       "epub": {
        "isAvailable": true,
        "acsTokenLink": "http://books.google.co.id/books/download/Medical_Multimedia-sample-epub.acsm?id=yjdQ8jTuCfgC&format=epub&output=acs4_fulfillment_token&dl_type=sample&source=gbs_api"
       },
       "pdf": {
        "isAvailable": true,
        "acsTokenLink": "http://books.google.co.id/books/download/Medical_Multimedia-sample-pdf.acsm?id=yjdQ8jTuCfgC&format=pdf&output=acs4_fulfillment_token&dl_type=sample&source=gbs_api"
       },
       "webReaderLink": "http://play.google.com/books/reader?id=yjdQ8jTuCfgC&hl=&printsec=frontcover&source=gbs_api",
       "accessViewStatus": "SAMPLE",
       "quoteSharingAllowed": false
      },
      "searchInfo": {
       "textSnippet": "This volume asserts that multimedia plays an increasingly important role in training and development for high-technology medical techniques."
      }
     },
     {
      "kind": "books#volume",
      "id": "7noK5nYnck0C",
      "etag": "ICrVWZc2aNs",
      "selfLink": "https://www.googleapis.com/books/v1/volumes/7noK5nYnck0C",
      "volumeInfo": {
       "title": "Body Movement and Speech in Medical Interaction",
       "authors": [
        "Christian Heath"
       ],
       "publisher": "Cambridge University Press",
       "publishedDate": "1986-09-26",
       "description": "Based on a collection of video recordings, this book offers a micro-analysis of the visual and vocal aspects of the interaction between doctors and patients. Using actual examples, Christian Heath explores the moment-by-moment coordination of body movement and speech by and between doctor and patient. This study makes a major contribution both to our understanding of doctor-patient communication, and to the growing body of research on face-to-face interaction.",
       "industryIdentifiers": [
        {
         "type": "ISBN_10",
         "identifier": "0521253357"
        },
        {
         "type": "ISBN_13",
         "identifier": "9780521253352"
        }
       ],
       "readingModes": {
        "text": false,
        "image": true
       },
       "pageCount": 200,
       "printType": "BOOK",
       "categories": [
        "Medical"
       ],
       "maturityRating": "NOT_MATURE",
       "allowAnonLogging": false,
       "contentVersion": "0.4.0.0.preview.1",
       "imageLinks": {
        "smallThumbnail": "http://books.google.com/books/content?id=7noK5nYnck0C&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api",
        "thumbnail": "http://books.google.com/books/content?id=7noK5nYnck0C&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api"
       },
       "language": "en",
       "previewLink": "http://books.google.co.id/books?id=7noK5nYnck0C&printsec=frontcover&dq=medical&hl=&cd=3&source=gbs_api",
       "infoLink": "http://books.google.co.id/books?id=7noK5nYnck0C&dq=medical&hl=&source=gbs_api",
       "canonicalVolumeLink": "https://books.google.com/books/about/Body_Movement_and_Speech_in_Medical_Inte.html?hl=&id=7noK5nYnck0C"
      },
      "saleInfo": {
       "country": "ID",
       "saleability": "NOT_FOR_SALE",
       "isEbook": false
      },
      "accessInfo": {
       "country": "ID",
       "viewability": "PARTIAL",
       "embeddable": true,
       "publicDomain": false,
       "textToSpeechPermission": "ALLOWED",
       "epub": {
        "isAvailable": false
       },
       "pdf": {
        "isAvailable": false
       },
       "webReaderLink": "http://play.google.com/books/reader?id=7noK5nYnck0C&hl=&printsec=frontcover&source=gbs_api",
       "accessViewStatus": "SAMPLE",
       "quoteSharingAllowed": false
      },
      "searchInfo": {
       "textSnippet": "Based on a collection of video recordings, this book offers a micro-analysis of the visual and vocal aspects of the interaction between doctors and patients."
      }
     }
    ]
}
var bookResultDummy = [{
        "id": "rXM1DgAAQBAJ",
        "title": "Medical and Psychosocial Aspects of Chronic Illness and Disability",
        "authors": [
            "Carlene Harrison",
            "University of North Carolina North Carolina Donna Falvo",
            "Valerie Weiss",
            "Donna Falvo",
            "Beverley E. Holland"
        ],
        "publisher": "Jones & Bartlett Learning",
        "publishedDate": "2017-01-15",
        "description": "Medical and Psychosocial Aspects of Chronic Illness, Sixth Edition is intended to teach students, counselors and other medical professionals working with the chronically ill and disabled how to better understand the manifestations of common chronic illnesses and the disabilities among their clients.",
        "pageCount": 650,
        "printType": "BOOK",
        "categories": [
        "Medical"
        ],
        "maturityRating": "NOT_MATURE",
        "imageLinks": {
            "smallThumbnail": "http://books.google.com/books/content?id=yjdQ8jTuCfgC&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api",
            "thumbnail": "http://books.google.com/books/content?id=yjdQ8jTuCfgC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api"
        },
        "language": "en",
        "previewLink": "http://books.google.co.id/books?id=rXM1DgAAQBAJ&printsec=frontcover&dq=medical&hl=&cd=1&source=gbs_api",
        "infoLink": "http://books.google.co.id/books?id=rXM1DgAAQBAJ&dq=medical&hl=&source=gbs_api",
        "canonicalVolumeLink": "https://books.google.com/books/about/Medical_and_Psychosocial_Aspects_of_Chro.html?hl=&id=rXM1DgAAQBAJ",
        "webReaderLink": "http://play.google.com/books/reader?id=rXM1DgAAQBAJ&hl=&printsec=frontcover&source=gbs_api"
    },
    {
        "id": "yjdQ8jTuCfgC",
        "title": "Medical Multimedia",
        "authors": [
            "Roy Rada",
            "Claude Ghaoui"
        ],
        "publisher": "Intellect Books",
        "publishedDate": "1995",
        "description": "This volume asserts that multimedia plays an increasingly important role in training and development for high-technology medical techniques. It examines a broad range of methods for incorporating computer-based multimedia packages into the world of medicine.",
        "pageCount": 197,
        "printType": "BOOK",
        "categories": [
            "Medical"
        ],
        "maturityRating": "NOT_MATURE",
        "imageLinks": {
        "smallThumbnail": "http://books.google.com/books/content?id=rXM1DgAAQBAJ&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api",
        "thumbnail": "http://books.google.com/books/content?id=rXM1DgAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api"
        },
        "language": "en",
        "previewLink": "http://books.google.co.id/books?id=yjdQ8jTuCfgC&printsec=frontcover&dq=medical&hl=&cd=2&source=gbs_api",
        "infoLink": "https://play.google.com/store/books/details?id=yjdQ8jTuCfgC&source=gbs_api",
        "canonicalVolumeLink": "https://market.android.com/details?id=book-yjdQ8jTuCfgC",
        "webReaderLink": "http://play.google.com/books/reader?id=yjdQ8jTuCfgC&hl=&printsec=frontcover&source=gbs_api"
    }
]
exports.sendBookRecommendation = (client, event, bookData) => {
    var bookCarousel = carouselController.newCarouselMessage();
    var defaultAnswer = {
        "type" : "text",
        "text" : "Books not found"
    }

    bookData.forEach(book => {
        var actions = [{
                "type" : "postback",
                "label" : "Add to Reading List",
                "data" : "action=addbook&bookId="+book.id
            },
            {   "type" : "uri",
                "label" : "Read Now",
                "url" : book.accessInfo.webReaderLink
            }
        ]
        var columns = carouselController.newColumn(book.imageLinks.thumbnail, "#FFFFFF", book.title, book.description, book.infoLink, actions)
        bookCarousel.template.columns.concat(columns)
    });

    if(bookCarousel.template.columns.length <= 0) {
        return client.replyMessage(event.replyToken, defaultAnswer)
    }

    return client.replyMessage(event.replyToken, bookCarousel)
}





